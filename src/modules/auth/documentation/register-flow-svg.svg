<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 700">
  <!-- Background -->
  <rect width="1000" height="700" fill="#f8f9fa" />
  
  <!-- Title -->
  <text x="500" y="30" font-family="Arial" font-size="24" text-anchor="middle" font-weight="bold">User Registration Flow - Hexagonal Architecture</text>
  
  <!-- Section backgrounds -->
  <rect x="40" y="60" width="250" height="580" rx="10" fill="#ffe6e6" stroke="#cc0000" stroke-width="2" />
  <rect x="320" y="60" width="280" height="580" rx="10" fill="#e6f5ff" stroke="#006699" stroke-width="2" />
  <rect x="630" y="60" width="320" height="580" rx="10" fill="#e6ffe6" stroke="#006600" stroke-width="2" />
  
  <!-- Section headers -->
  <text x="165" y="90" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">PRIMARY ADAPTERS</text>
  <text x="165" y="110" font-family="Arial" font-size="16" text-anchor="middle">(Controllers/DTOs)</text>
  
  <text x="460" y="90" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">APPLICATION LAYER</text>
  <text x="460" y="110" font-family="Arial" font-size="16" text-anchor="middle">(Commands/Services)</text>
  
  <text x="790" y="90" font-family="Arial" font-size="18" text-anchor="middle" font-weight="bold">DOMAIN + SECONDARY ADAPTERS</text>
  <text x="790" y="110" font-family="Arial" font-size="16" text-anchor="middle">(Entities/Repositories)</text>
  
  <!-- Client -->
  <rect x="90" y="140" width="150" height="60" rx="5" fill="#ffffff" stroke="#333333" stroke-width="2" />
  <text x="165" y="175" font-family="Arial" font-size="14" text-anchor="middle">HTTP Client</text>
  <text x="165" y="195" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">POST /auth/register</text>
  
  <!-- ValidationPipe -->
  <rect x="90" y="240" width="150" height="60" rx="5" fill="#ffffff" stroke="#333333" stroke-width="2" />
  <text x="165" y="265" font-family="Arial" font-size="14" text-anchor="middle">ValidationPipe</text>
  <text x="165" y="285" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">main.ts</text>
  
  <!-- RegisterUserDTO -->
  <rect x="90" y="340" width="150" height="60" rx="5" fill="#ffffff" stroke="#ff6666" stroke-width="2" />
  <text x="165" y="365" font-family="Arial" font-size="14" text-anchor="middle">RegisterUserDto</text>
  <text x="165" y="385" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">adapters/primary/dtos/</text>
  <text x="165" y="400" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">register-user.dto.ts</text>
  
  <!-- AuthController -->
  <rect x="90" y="440" width="150" height="60" rx="5" fill="#ffffff" stroke="#ff6666" stroke-width="2" />
  <text x="165" y="465" font-family="Arial" font-size="14" text-anchor="middle">AuthController</text>
  <text x="165" y="485" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">adapters/primary/rest/</text>
  <text x="165" y="500" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">auth.controller.ts</text>
  
  <!-- RegisterUserCommand -->
  <rect x="385" y="160" width="150" height="60" rx="5" fill="#ffffff" stroke="#3399cc" stroke-width="2" />
  <text x="460" y="185" font-family="Arial" font-size="14" text-anchor="middle">RegisterUserCommand</text>
  <text x="460" y="205" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">application/commands/</text>
  <text x="460" y="220" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">register-user.command.ts</text>
  
  <!-- AuthService -->
  <rect x="385" y="260" width="150" height="70" rx="5" fill="#ffffff" stroke="#3399cc" stroke-width="2" />
  <text x="460" y="285" font-family="Arial" font-size="14" text-anchor="middle">AuthService.register()</text>
  <text x="460" y="305" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">application/services/</text>
  <text x="460" y="320" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">auth.service.ts</text>
  
  <!-- EventBus -->
  <rect x="385" y="370" width="150" height="60" rx="5" fill="#ffffff" stroke="#3399cc" stroke-width="2" />
  <text x="460" y="395" font-family="Arial" font-size="14" text-anchor="middle">EventBus</text>
  <text x="460" y="415" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">@nestjs/cqrs</text>
  
  <!-- PasswordService -->
  <rect x="385" y="470" width="150" height="80" rx="5" fill="#ffffff" stroke="#3399cc" stroke-width="2" />
  <text x="460" y="495" font-family="Arial" font-size="14" text-anchor="middle">IPasswordService</text>
  <text x="460" y="510" font-family="Arial" font-size="12" text-anchor="middle" font-style="italic">(Interface)</text>
  <text x="460" y="530" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">domain/services/</text>
  <text x="460" y="545" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">password.service.ts</text>
  
  <!-- User Entity -->
  <rect x="710" y="140" width="150" height="70" rx="5" fill="#ffffff" stroke="#33cc33" stroke-width="2" />
  <text x="785" y="165" font-family="Arial" font-size="14" text-anchor="middle">User Entity</text>
  <text x="785" y="180" font-family="Arial" font-size="12" text-anchor="middle" font-style="italic">(Aggregate Root)</text>
  <text x="785" y="200" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">domain/models/</text>
  <text x="785" y="215" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">user.entity.ts</text>
  
  <!-- Role Value Object -->
  <rect x="710" y="240" width="150" height="60" rx="5" fill="#ffffff" stroke="#33cc33" stroke-width="2" />
  <text x="785" y="265" font-family="Arial" font-size="14" text-anchor="middle">Role</text>
  <text x="785" y="280" font-family="Arial" font-size="12" text-anchor="middle" font-style="italic">(Value Object)</text>
  <text x="785" y="300" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">domain/models/</text>
  <text x="785" y="315" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">role.value-object.ts</text>
  
  <!-- UserCreatedEvent -->
  <rect x="710" y="330" width="150" height="60" rx="5" fill="#ffffff" stroke="#33cc33" stroke-width="2" />
  <text x="785" y="355" font-family="Arial" font-size="14" text-anchor="middle">UserCreatedEvent</text>
  <text x="785" y="375" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">domain/events/</text>
  <text x="785" y="390" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">user-created.event.ts</text>
  
  <!-- BcryptPasswordService -->
  <rect x="710" y="420" width="150" height="80" rx="5" fill="#ffffff" stroke="#33cc33" stroke-width="2" />
  <text x="785" y="445" font-family="Arial" font-size="14" text-anchor="middle">BcryptPasswordService</text>
  <text x="785" y="460" font-family="Arial" font-size="12" text-anchor="middle" font-style="italic">(Implementation)</text>
  <text x="785" y="480" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">adapters/secondary/security/</text>
  <text x="785" y="495" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">bcrypt-password.service.ts</text>
  
  <!-- TypeormUserRepository -->
  <rect x="710" y="530" width="150" height="80" rx="5" fill="#ffffff" stroke="#33cc33" stroke-width="2" />
  <text x="785" y="555" font-family="Arial" font-size="14" text-anchor="middle">TypeormUserRepository</text>
  <text x="785" y="575" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">adapters/secondary/persistence/</text>
  <text x="785" y="590" font-family="Arial" font-size="12" text-anchor="middle" fill="#666666">typeorm-user.repository.ts</text>
  
  <!-- Flow arrows -->
  <!-- Client to ValidationPipe -->
  <line x1="165" y1="200" x2="165" y2="235" stroke="#333333" stroke-width="2" stroke-dasharray="5,5" />
  <polygon points="165,240 160,230 170,230" fill="#333333" />
  
  <!-- ValidationPipe to RegisterUserDTO -->
  <line x1="165" y1="300" x2="165" y2="335" stroke="#333333" stroke-width="2" stroke-dasharray="5,5" />
  <polygon points="165,340 160,330 170,330" fill="#333333" />
  
  <!-- RegisterUserDTO to AuthController -->
  <line x1="165" y1="400" x2="165" y2="435" stroke="#333333" stroke-width="2" stroke-dasharray="5,5" />
  <polygon points="165,440 160,430 170,430" fill="#333333" />
  
  <!-- AuthController to RegisterUserCommand -->
  <path d="M 240 470 C 280 470, 345 190, 385 190" stroke="#333333" fill="none" stroke-width="2" />
  <polygon points="385,190 375,185 375,195" fill="#333333" />
  <text x="300" y="210" font-family="Arial" font-size="12" fill="#333333">1. Create command</text>
  
  <!-- RegisterUserCommand to AuthService -->
  <line x1="460" y1="220" x2="460" y2="255" stroke="#333333" stroke-width="2" />
  <polygon points="460,260 455,250 465,250" fill="#333333" />
  <text x="470" y="240" font-family="Arial" font-size="12" fill="#333333">2. Handle command</text>
  
  <!-- AuthService to PasswordService (interface) -->
  <path d="M 460 330 C 460 380, 460 430, 460 465" stroke="#333333" fill="none" stroke-width="2" />
  <polygon points="460,470 455,460 465,460" fill="#333333" />
  <text x="470" y="400" font-family="Arial" font-size="12" fill="#333333">3. Hash password</text>
  
  <!-- PasswordService to BcryptPasswordService (implementation) -->
  <path d="M 535 510 C 600 510, 650 460, 710 460" stroke="#333333" fill="none" stroke-width="2" />
  <polygon points="710,460 700,455 700,465" fill="#333333" />
  <text x="600" y="490" font-family="Arial" font-size="12" fill="#333333">4. Concrete implementation</text>
  
  <!-- AuthService to Role -->
  <path d="M 535 295 C 600 295, 650 270, 710 270" stroke="#333333" fill="none" stroke-width="2" />
  <polygon points="710,270 700,265 700,275" fill="#333333" />
  <text x="610" y="260" font-family="Arial" font-size="12" fill="#333333">5. Validate role</text>
  
  <!-- AuthService to User -->
  <path d="M 535 280 C 600 240, 650 175, 710 175" stroke="#333333" fill="none" stroke-width="2" />
  <polygon points="710,175 700,170 700,180" fill="#333333" />
  <text x="610" y="195" font-family="Arial" font-size="12" fill="#333333">6. Create user</text>
  
  <!-- User to UserCreatedEvent -->
  <line x1="785" y1="215" x2="785" y2="325" stroke="#333333" stroke-width="2" />
  <polygon points="785,330 780,320 790,320" fill="#333333" />
  <text x="795" y="270" font-family="Arial" font-size="12" fill="#333333">7. Apply event</text>
  
  <!-- AuthService to Repository -->
  <path d="M 460 330 C 460 450, 650 570, 710 570" stroke="#333333" fill="none" stroke-width="2" />
  <polygon points="710,570 700,565 700,575" fill="#333333" />
  <text x="570" y="540" font-family="Arial" font-size="12" fill="#333333">8. Save user</text>
  
  <!-- AuthService to EventBus -->
  <line x1="460" y1="330" x2="460" y2="365" stroke="#333333" stroke-width="2" />
  <polygon points="460,370 455,360 465,360" fill="#333333" />
  <text x="470" y="350" font-family="Arial" font-size="12" fill="#333333">9. Publish events</text>
  
  <!-- Response back to controller -->
  <path d="M 385 295 C 350 350, 280 450, 240 450" stroke="#333333" fill="none" stroke-width="2" stroke-dasharray="5,5" />
  <polygon points="240,450 250,445 250,455" fill="#333333" />
  <text x="290" y="380" font-family="Arial" font-size="12" fill="#333333">10. Return user</text>
  
  <!-- Legend -->
  <rect x="40" y="650" width="20" height="20" fill="#ffe6e6" stroke="#cc0000" stroke-width="1" />
  <text x="70" y="664" font-family="Arial" font-size="12">Primary Adapters (Driving)</text>
  
  <rect x="230" y="650" width="20" height="20" fill="#e6f5ff" stroke="#006699" stroke-width="1" />
  <text x="260" y="664" font-family="Arial" font-size="12">Application Layer</text>
  
  <rect x="420" y="650" width="20" height="20" fill="#e6ffe6" stroke="#006600" stroke-width="1" />
  <text x="450" y="664" font-family="Arial" font-size="12">Domain Layer + Secondary Adapters (Driven)</text>
  
  <line x1="650" y1="650" x2="670" y2="650" stroke="#333333" stroke-width="2" />
  <polygon points="675,650 665,645 665,655" fill="#333333" />
  <text x="685" y="654" font-family="Arial" font-size="12">Synchronous Flow</text>
  
  <line x1="650" y1="670" x2="670" y2="670" stroke="#333333" stroke-width="2" stroke-dasharray="5,5" />
  <polygon points="675,670 665,665 665,675" fill="#333333" />
  <text x="685" y="674" font-family="Arial" font-size="12">HTTP/Response Flow</text>
</svg>